<!DOCTYPE html>
<html>
  <head></head>
  <body>
    <button id='train'>Train</button>
    <script>

    const init = () => {
        let data_uri
        const button = document.querySelector('#train')
        button.disabled = true
        let toSend
        let height
        let width
        const img = new Image()
        img.crossOrigin = ''
        img.onload = () => {
          const canvas = document.createElement('canvas')
          canvas.width = img.naturalWidth
          canvas.height = img.naturalHeight
          width = img.naturalWidth
          height = img.naturalHeight
          const ctx = canvas.getContext('2d')
          ctx.drawImage(img,0,0)
          console.log('converting', width, height)
          data_uri = canvas.toDataURL('image/png')
          button.disabled = false
        }
        img.src = '/img.png'
        button.onclick = () => {
          fetch('/train', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              height,
              width,
              open: [
                data_uri,
                data_uri,
                data_uri,
              ],
              closed: [
                data_uri,
                data_uri,
                data_uri,
              ],
            })
          })
            .then(res => res.json())
            .then(res => console.log(res))
        }
      }

      (() => setTimeout(init, 500))()
    </script>
  </body>
</html>